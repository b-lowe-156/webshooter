<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8"/>
    <title>Babylon - Getting Started</title>
    <script src="http://cdn.babylonjs.com/2-5/babylon.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.12.0/matter.js"></script>
    <style>
        html, body {
            overflow: hidden;
            width   : 100%;
            height  : 100%;
            margin  : 0;
            padding : 0;
        }
        #renderCanvas {
            width   : 100%;
            height  : 100%;
            touch-action: none;
        }
    </style>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        const inputState = {
            forward: false,
            backward: false,
            strafeLeft: false,
            strafeRight: false,
            leftMouseDown: false,
        }
        window.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('renderCanvas')
            const engine = new BABYLON.Engine(canvas, true)

            let globalScene = undefined

            const initScene = function() {
                BABYLON.SceneLoader.Load("", "assets/heli.babylon", engine, scene => {
                    globalScene = scene
                    scene.executeWhenReady(() => {


                        const camera = new BABYLON.FollowCamera("FollowCam", new BABYLON.Vector3(0, 15, -45), scene)
                        camera.lockedTarget  = scene.meshes.find(m => m.id === 'helicopter')
                        
                        camera.radius = 30; // how far from the object to follow
                        camera.heightOffset = 8; // how high above the object to place the camera
                        camera.rotationOffset = 90; // the viewing angle
                        camera.cameraAcceleration = 0.05 // how fast to move
                        camera.maxCameraSpeed = 20 // speed limit
                        
                        scene.activeCamera = camera; // remember to notify your scene about a new active camera


                        // Attach camera to canvas inputs
                       // scene.activeCamera.attachControl(canvas)

                        var light = new BABYLON.HemisphericLight('light1', new BABYLON.Vector3(0,1,0), scene)

                        // Once the scene is loaded, just register a render loop to render it
                        engine.runRenderLoop(() => {
                            scene.render()
                        })
                    })
                }, progress => {
                    // To do: give progress feedback to user
                })
            }

            initScene()

            window.addEventListener('resize', () => {
                engine.resize()
            })
            
            window.addEventListener('keydown', e => {
                if (!globalScene) {
                    return
                } 
                let helicopter = globalScene.meshes.find(m => m.id === 'helicopter')
                helicopter.position.y += 0.1
                console.log('helicopter', helicopter)
                //store.dispatch({ type: 'keydown', payload: e.keyCode })
            })
        })
    </script>
</body>
</html>